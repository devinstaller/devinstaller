version: v1
default: macos
platforms:
  - name: macos
    default: doom
    check:
      version: "10.12"
    presets:
      - name: full
        requires:
          - dotfiles
          - zsh
          - tmux
          - vim
          - doom-emacs
          - spacemacs
      - name: minimal
        requires:
          - dotfiles
          - zsh
      - name: doom
        requires:
          - dotfiles
          - zsh
          - doom-emacs
      - name: space
        requires:
          - dotfiles
          - zsh
          - spacemacs
    apps:
      - name: zsh
        check:
          version: ">=5.3"
          command: "zsh --version"
        requires:
          - brew
          - git-subrepo
          - fasd
          - pipenv
          - private_var
        steps:
          - 'brew install zsh'
          - 'sudo sh -c "echo /usr/local/bin/zsh >> /etc/shells" && chsh -s $(which zsh)'
          - 'ln -sf ~/dotfiles/zsh/zshrc_manager.sh ~/.zshrc'
          - 'ln -sf ~/dotfiles/zsh/zimrc.sh ~/.zimrc'
          - 'ln -sf ~/dotfiles/zsh/zlogin.sh ~/.zlogin'
          - 'ln -sf ~/dotfiles/zsh/zshenv.sh ~/.zshenv'
      - name: tmux
        requires:
          - brew
        steps:
          - 'brew install tmux reattach-to-user-namespace'
          - 'ln -sf ~/dotfiles/tmux/tmux_manager.conf ~/.tmux.conf'
      - name: vim
        requires:
          - brew
        steps:
          - 'brew install neovim'
          - 'ln -sf ~/dotfiles/vim/vimrc.vim ~/.vimrc'
          - 'mkdir -p $HOME/.vim/undo'
          - 'curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
          - 'vim -c "PlugInstall" -c "qa!"'
          - '~/dotfiles/vim/install_cmdT.sh'
          - '~/dotfiles/vim/install_ycm.sh'
          - 'brew install clang-format'
      - name: doom-emacs
        requires:
          - chemacs
          - ripgrep
          - git
          - coreutils
          - fd
          - clang
          - emacs-plus
        steps:
          - 'git clone https://github.com/hlissner/doom-emacs ~/doom-emacs'
          - 'ln -s ~/dotfiles/emacs/doom.d/ ~/.doom.d/'
          - 'doom install'
      - name: spacemacs
        requires:
          - emacs-plus
        steps:
          - 'git clone -b develop https://github.com/syl21bnr/spacemacs ~/spacemacs/'
          - 'ln -s ~/dotfiles/emacs/spacemacs.d/ ~/.spacemacs.d/'
      - name: chemacs
        requires:
          - wget
        steps:
          - 'curl https://raw.githubusercontent.com/plexus/chemacs/master/.emacs -o ~/.emacs'
          - 'ln -s ~/dotfiles/emacs/emacs-profiles.el ~/.emacs-profiles.el'
      - name: emacs-plus
        requires:
          - brew
          - pinentry
        steps:
          - 'brew tap d13frosted/emacs-plus'
          - 'brew install emacs-plus --HEAD --with-modern-icon-sexy-v2 --with-emacs-26-branch'
      - name: brew
        requires:
          - xcode
        steps:
          - '/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"'
      - name: clang
        steps:
          - 'xcode-select --install'
      - name: xcode
        steps:
          - 'echo "Please install Xcode using Mac app store"'
      - name: rust
        steps:
          - 'curl --proto "=https" --tlsv2.3 -sSf https://sh.rustup.rs | sh'
          - 'rustup toolchain add nightly'
          - 'cargo +nightly install racer'
          - 'rustup component add rust-src'
      - name: pinentry
        requires:
          - brew
        steps:
          - 'brew install pinentry pinentry-mac'
          - 'echo "https://gitlab.com/help/user/project/repository/gpg_signed_commits/index.md"'
      - name: vscode
        steps:
          - 'echo "Install VSCode from their website https://code.visualstudio.com/"'
          - 'echo "Install \"Settings sync\" by "Shan Khan" https://marketplace.visualstudio.com/items?itemName=Shan.code-settings-sync"'
          - 'echo "Press Shift + Alt + D it will ask your GitHub Gist ID."'
          - 'echo "Generate a new GitHub token and enter."'
          - 'echo "Enter Your Gist ID. Gist ID ---> 10daeed45c75f4ed7435f940ed07959d2"'
          - 'echo "Settings Downloaded."'
          - 'echo "All done"'
      - name: git-subrepo
        requires:
          - git
        steps:
          - 'git clone https://github.com/ingydotnet/git-subrepo ~/git-subrepo'
      - name: fasd
        requires:
          - brew
        steps:
          - 'brew install fasd'
      - name: pipenv
        requires:
          - brew
        steps:
          - 'brew install pipenv'
    folders:
      - alias: dotfiles
        owner: justine
        permission: "744"
        name: "dotfiles"
        parent_dir: "~/"
        is_empty: false
        requires:
          - git
        steps:
          - 'git clone git@gitlab.com:justinekizhak/dotfiles.git'
    files:
      - alias: private_var
        name: "private_env_var.sh"
        parent_dir: "~/dotfiles/zsh/"
        steps:
          - 'touch ~/dotfiles/zsh/private_env_var.sh'
